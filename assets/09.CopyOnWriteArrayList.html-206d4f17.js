import{_ as n,V as s,W as a,X as p}from"./framework-a569e214.js";const t="/img/juc/image-20210311170337561.png",e="/img/juc/image-20210311171002010.png",c="/img/juc/image-20210311171108049.png",o={},u=p(`<h2 id="arraylist并发修改异常" tabindex="-1"><a class="header-anchor" href="#arraylist并发修改异常" aria-hidden="true">#</a> ArrayList并发修改异常</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>程序报错（多运行几次，也有不报错的）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">,</span> <span class="token number">98f</span>b1<span class="token punctuation">,</span> c9918<span class="token punctuation">,</span> <span class="token number">3068</span>b<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">,</span> <span class="token number">98f</span>b1<span class="token punctuation">,</span> c9918<span class="token punctuation">,</span> <span class="token number">3068</span>b<span class="token punctuation">,</span> <span class="token number">928f</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5f</span><span class="token number">0d</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0d</span>d3f<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">,</span> <span class="token number">98f</span>b1<span class="token punctuation">,</span> c9918<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">,</span> <span class="token number">98f</span>b1<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">,</span> <span class="token number">98f</span>b1<span class="token punctuation">,</span> c9918<span class="token punctuation">,</span> <span class="token number">3068</span>b<span class="token punctuation">,</span> <span class="token number">928f</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5f</span><span class="token number">0d</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">74</span>b29<span class="token punctuation">,</span> <span class="token number">086</span>cd<span class="token punctuation">,</span> <span class="token number">944</span>b4<span class="token punctuation">,</span> <span class="token number">98f</span>b1<span class="token punctuation">,</span> c9918<span class="token punctuation">,</span> <span class="token number">3068</span>b<span class="token punctuation">,</span> <span class="token number">928f</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token class-name">Exception</span> in thread <span class="token string">&quot;3&quot;</span> <span class="token class-name">Exception</span> in thread <span class="token string">&quot;1&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ConcurrentModificationException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>java.util.ConcurrentModificationException 并发修改异常。</p></blockquote><p><code>并发下，ArrayList是不安全的。</code></p><h2 id="解决办法" tabindex="-1"><a class="header-anchor" href="#解决办法" aria-hidden="true">#</a> 解决办法</h2><h3 id="_1、使用线程安全集合vector" tabindex="-1"><a class="header-anchor" href="#_1、使用线程安全集合vector" aria-hidden="true">#</a> 1、使用线程安全集合Vector</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">,</span> dfd0d<span class="token punctuation">,</span> <span class="token number">9e06f</span><span class="token punctuation">,</span> b9e1c<span class="token punctuation">,</span> <span class="token number">26</span>a1b<span class="token punctuation">,</span> b95c0<span class="token punctuation">,</span> <span class="token number">7</span>b0fb<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">,</span> dfd0d<span class="token punctuation">,</span> <span class="token number">9e06f</span><span class="token punctuation">,</span> b9e1c<span class="token punctuation">,</span> <span class="token number">26</span>a1b<span class="token punctuation">,</span> b95c0<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">,</span> dfd0d<span class="token punctuation">,</span> <span class="token number">9e06f</span><span class="token punctuation">,</span> b9e1c<span class="token punctuation">,</span> <span class="token number">26</span>a1b<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">,</span> dfd0d<span class="token punctuation">,</span> <span class="token number">9e06f</span><span class="token punctuation">,</span> b9e1c<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">,</span> dfd0d<span class="token punctuation">,</span> <span class="token number">9e06f</span><span class="token punctuation">,</span> b9e1c<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">,</span> dfd0d<span class="token punctuation">,</span> <span class="token number">9e06f</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">,</span> dfd0d<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">,</span> <span class="token number">6381</span>a<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">324d</span><span class="token number">5</span><span class="token punctuation">,</span> c50d1<span class="token punctuation">,</span> <span class="token number">7d</span>cc0<span class="token punctuation">]</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、使用集合工具类collections-synchronizedlist" tabindex="-1"><a class="header-anchor" href="#_2、使用集合工具类collections-synchronizedlist" aria-hidden="true">#</a> 2、使用集合工具类Collections.synchronizedList</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3、juc包下的copyonwritearraylist类" tabindex="-1"><a class="header-anchor" href="#_3、juc包下的copyonwritearraylist类" aria-hidden="true">#</a> 3、JUC包下的CopyOnWriteArrayList类</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+t+'" alt="image-20210311170337561" tabindex="0" loading="lazy"><figcaption>image-20210311170337561</figcaption></figure><h2 id="copyonwrite写入时复制" tabindex="-1"><a class="header-anchor" href="#copyonwrite写入时复制" aria-hidden="true">#</a> CopyOnWrite写入时复制</h2><blockquote><p>COW：计算机程序设计领域的一种优化策略。</p></blockquote><p>多个线程调用的时候，读取的时候list是固定的。写入的时候可能会存在覆盖操作。在写入的时候，避免覆盖造成数据问题。</p><p>读写分离。</p><h2 id="copyonwritearraylist的优势" tabindex="-1"><a class="header-anchor" href="#copyonwritearraylist的优势" aria-hidden="true">#</a> CopyOnWriteArrayList的优势</h2><p>Vector直接在方法上使用<strong>synchronized</strong>加了锁，性能较低。</p><figure><img src="'+e+'" alt="image-20210311171002010" tabindex="0" loading="lazy"><figcaption>image-20210311171002010</figcaption></figure><p>CopyOnWriteArrayList使用的是<strong>Lock</strong>锁。性能更好。</p><figure><img src="'+c+'" alt="image-20210311171108049" tabindex="0" loading="lazy"><figcaption>image-20210311171108049</figcaption></figure>',24),l=[u];function i(k,r){return s(),a("div",null,l)}const m=n(o,[["render",i],["__file","09.CopyOnWriteArrayList.html.vue"]]);export{m as default};
