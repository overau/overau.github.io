import{_ as t,V as p,W as o,Y as n,Z as s,$ as e,X as c,F as i}from"./framework-a569e214.js";const l={},u=n("blockquote",null,[n("p",null,"朋友的定位、附近的人、打车距离计算。")],-1),r=n("p",null,"Redis的Geo在Redis3.2版本就推出了。这个功能可以推算地理位置的信息，两地之间的距离，方圆几里的人。",-1),k={href:"https://jingweidu.51240.com/",target:"_blank",rel:"noopener noreferrer"},m=n("p",null,"只有6个命令。",-1),d=n("blockquote",null,[n("p",null,"geoadd")],-1),b={href:"http://www.redis.cn/commands/geoadd.html",target:"_blank",rel:"noopener noreferrer"},v=c(`<blockquote><ul><li>有效的经度从-180度到180度。</li><li>有效的纬度从-85.05112878度到85.05112878度。</li></ul></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># geoadd 添加城市数据</span>
<span class="token comment"># 规则：地球两极无法直接添加。一般会下载城市数据，直接通过Java程序一次性导入</span>
<span class="token comment"># 参数：key 值(精度 维度 城市名称)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">106.82922</span> <span class="token number">27.53625</span> zunyi
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">116.23128</span> <span class="token number">40.22077</span> beijin
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">106.54041</span> <span class="token number">29.40268</span> chongqing <span class="token number">113.88308</span> <span class="token number">22.55329</span> shenzhen
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">120.21201</span> <span class="token number">30.2084</span> hangzhou
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">108.93425</span> <span class="token number">34.23053</span> xian
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>geopos</p></blockquote><p><code>获得当前定位：一定是一个坐标值。</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos china:city zunyi			<span class="token comment"># 获取指定城市的精度和维度</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;106.82921737432479858&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;27.53624874837839087&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos china:city beijin zunyi chongqing	<span class="token comment"># 获取多个城市的精度和维度</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;116.23128265142440796&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;40.22076905438526495&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;106.82921737432479858&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;27.53624874837839087&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;106.54040783643722534&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> &quot;29.402680
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>geodist</p><p>指定单位的参数 unit 必须是以下单位的其中一个：</p><ul><li>m 表示单位为米</li><li>km 表示单位为千米</li><li>mi 表示单位为英里</li><li>ft 表示单位为英尺。</li></ul></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city zunyi chongqing 			<span class="token comment"># 遵义到重庆的直线距离。默认单位m</span>
<span class="token string">&quot;209507.7798&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city zunyi chongqing m
<span class="token string">&quot;209507.7798&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city zunyi chongqing km		<span class="token comment"># 遵义到重庆的直线距离。单位km</span>
<span class="token string">&quot;209.5078&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:Lcity beijin chongqing km
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city beijin chongqing km
<span class="token string">&quot;1491.5364&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>georadius 以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</p></blockquote><p>附近的人？（获得所有附近的人的地址，定位）。通过半径来查询。所有的数据应该都录入china:city，才会让结果更加清晰。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km	<span class="token comment"># 获取以(110,30)经纬度为中心,寻找方圆1000km内的城市</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;shenzhen&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;hangzhou&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km <span class="token comment"># 获取以(110,30)经纬度为中心,寻找方圆500km内的城市</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withcoord	<span class="token comment"># 显示他人的定位信息</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;106.82921737432479858&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;27.53624874837839087&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;106.54040783643722534&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;29.40268053517299762&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;108.93425256013870239&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;34.23053097599082406&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist		<span class="token comment"># 显示到中心位置的直线距离</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;413.0760&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;340.7667&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;481.1278&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withhash		<span class="token comment"># 显示hash</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4025019788724370</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4026046519194590</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4040115270369361</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist count <span class="token number">1</span>		<span class="token comment"># 筛选出指定的结果</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;340.7667&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist count <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;340.7667&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;413.0760&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist count <span class="token number">3</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;340.7667&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;413.0760&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;481.1278&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>georadiusbymember 指定成员的位置被用作查询的中心。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 找出位于指定元素周围的其他元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadiusbymember china:city zunyi <span class="token number">1000</span> km		
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;shenzhen&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadiusbymember china:city zunyi <span class="token number">400</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadiusbymember china:city chongqing <span class="token number">400</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>geohash 返回一个或多个位置元素的 Geohash 表示。</p></blockquote><p>该命令将返回11个字符的Geohash字符串。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 将二维的经纬度转化为一维的字符串。如果两个字符串越接近，那么则距离越近。</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geohash china:city beijin chongqing
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;wx4sucvncn0&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;wm5z22s7520&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Geo底层的我实现原理其实就是Zset。我们可以使用Zset命令来操作Geo。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange china:city <span class="token number">0</span> <span class="token parameter variable">-1</span>		<span class="token comment"># 查看地图中全部元素</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;shenzhen&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;hangzhou&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;beijin&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrem china:city beijin		<span class="token comment"># 移除地图中指定的元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange china:city <span class="token number">0</span> <span class="token parameter variable">-1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zunyi&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;shenzhen&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;hangzhou&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,17);function g(q,h){const a=i("ExternalLinkIcon");return p(),o("div",null,[u,r,n("p",null,[s("城市经纬度查询："),n("a",k,[s("https://jingweidu.51240.com/"),e(a)])]),m,d,n("p",null,[n("a",b,[s("http://www.redis.cn/commands/geoadd.html"),e(a)])]),v])}const f=t(l,[["render",g],["__file","17.Geospatial 地理位置.html.vue"]]);export{f as default};
