import{_ as t,V as a,W as l,Y as n,Z as i,$ as p,X as s,F as o}from"./framework-a569e214.js";const c="/img/redis/image-20201231182311004.png",r="/img/redis/image-20201231183722468.png",u="/img/redis/image-20201231183647028.png",d={},m=s('<p>Redis发布订阅（pub/sub）是一种消息通信模式：发送者（pub）发送消息，订阅者（sub）接收消息。</p><p><code>Redis客户端可以订阅任意数量的频道。</code></p><p>订阅/发布消息图：</p><ul><li>消息发送者</li><li>频道</li><li>消息订阅者</li></ul><figure><img src="'+c+'" alt="image-20201231182311004" tabindex="0" loading="lazy"><figcaption>image-20201231182311004</figcaption></figure><blockquote><p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client1 、 client2 和 client3 之间的关系：</p></blockquote><figure><img src="'+r+'" alt="image-20201231183722468" tabindex="0" loading="lazy"><figcaption>image-20201231183722468</figcaption></figure><blockquote><p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p></blockquote><figure><img src="'+u+'" alt="image-20201231183647028" tabindex="0" loading="lazy"><figcaption>image-20201231183647028</figcaption></figure><blockquote><p>命令</p></blockquote>',10),b={href:"https://www.runoob.com/redis/redis-pub-sub.html",target:"_blank",rel:"noopener noreferrer"},g=s(`<table><thead><tr><th style="text-align:left;">序号</th><th style="text-align:left;">命令及描述</th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:left;">[PSUBSCRIBE pattern pattern ...] 订阅一个或多个符合给定模式的频道。</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;">PUBSUB subcommand [argument [argument ...]] 查看订阅与发布系统状态。</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;">PUBLISH channel message 将信息发送到指定的频道。</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:left;">PUNSUBSCRIBE [pattern [pattern ...]] 退订所有给定模式的频道。</td></tr><tr><td style="text-align:left;">5</td><td style="text-align:left;">[SUBSCRIBE channel channel ...] 订阅给定的一个或多个频道的信息。</td></tr><tr><td style="text-align:left;">6</td><td style="text-align:left;">UNSUBSCRIBE [channel [channel ...]] 指退订给定的频道。</td></tr></tbody></table><blockquote><p>测试</p></blockquote><p><code>订阅端</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SUBSCRIBE hejin				<span class="token comment"># 订阅一个频道 hejin</span>
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;hejin&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 等待读取推送的信息</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;message&quot;</span>	<span class="token comment"># 消息</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;hejin&quot;</span>		<span class="token comment"># 哪个频道</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;hello&quot;</span>		<span class="token comment"># 消息具体内容</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;message&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;hejin&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>发送端</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PUBLISH hejin hello			<span class="token comment"># 发布者发送消息到频道 hejin</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PUBLISH hejin <span class="token string">&#39;hello,redis&#39;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>原理</p></blockquote><p>Redis使用C实现的，通过分析Redis源码里的<code>pubsub.c</code>文件，了解发布和订阅机制的底层实现，借此加深对Redis的理解。</p><p>Redis通过publish、subscribe和psubscribe等命令实现发布和订阅功能。</p><p>通过subscribe命令订阅某频道之后，redis-server里维护了一个字典，字典的键就是一个个channel，而字典的值则是一个链表。链表中保存了所有订阅这个channel的客户端。subscribe命令的关键，就是将客户端添加到给定channel的订阅链表中。</p><p>通过publish命令向订阅者发送消息，redis-server会使用给定的channel作为建，在它所维护的channel字典中查找记录了订阅这个channel的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者。</p><p>Pub/Sub从字面上理解就是发布（Publish）和订阅（Subscribe），在Redis中，你可以设定对某一个key值进行消息发布及消息订阅，当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用户就是用作实时消息系统，比如普通的即时聊天，取料等功能。</p><blockquote><p>使用场景</p></blockquote><ul><li>实时消息系统</li><li>实时聊天（频道当作聊天室，将信息回显给所有人即可）</li><li>订阅、关注系统</li></ul><p>稍微复杂的场景，就会使用消息中间件MQ来做。</p>`,15);function k(h,v){const e=o("ExternalLinkIcon");return a(),l("div",null,[m,n("p",null,[n("a",b,[i("https://www.runoob.com/redis/redis-pub-sub.html"),p(e)])]),g])}const _=t(d,[["render",k],["__file","28.Redis发布订阅.html.vue"]]);export{_ as default};
